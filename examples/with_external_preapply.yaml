# JACKAL Sequential Calibration with External Pre-apply
# Demonstrates: External A + sequential K -> G solving
# CLI: jackal run with_external_preapply.yaml
# Python: from jackal import solve_from_yaml; solve_from_yaml('with_external_preapply.yaml')

solve:
  - jones: [K, G]                 # Sequential: K, then G (with K)
    ms: observation.ms

    # Output
    output: kg_with_a.h5

    # Antenna & Feed
    ref_ant: 4
    feed_basis: linear

    # MS Selection
    field: 3C147,3C286            # Comma syntax: solve for both fields
    spw: '0'
    scans: 10~20

    # Solution Intervals
    time_interval: [inf, 60s]     # K: inf, G: 60s
    freq_interval: [4MHz, full]   # K: 4MHz, G: full

    # Column Selection
    data_col: DATA
    model_col: MODEL_DATA

    # RFI Flagging
    rfi_enable: true
    rfi_threshold: 5.0

    # Solver Parameters
    max_iter: 100
    tol: 1.0e-10

    # Solver-specific options
    phase_only: [false, false]

    # External pre-apply calibration
    pre_apply_file: [a_calibration.h5]   # Load A Jones from this file
    pre_apply_jones: [A]                  # Apply A Jones type

# Execution Flow (with pre-apply_jones=[A]):
# 1. Load external A from a_calibration.h5
# 2. Solve K with A pre-applied
# 3. Solve G with A+K pre-applied (K from step 2)
# 4. Save K and G to kg_with_a.h5
#
# This enables complex calibration chains where earlier steps
# can be reused across multiple observations.

# JACKAL Calibration Config
# =========================
#
# Run: jackal run config.yaml

# MS files and their fields
# feed_basis is auto-detected from MS
ms_files:
  - path: flux_cal.ms
    fields: [3C147, 3C286]
  - path: phase_cal.ms  
    fields: [J1331+305]
  - path: target.ms
    fields: [NGC1234]

# Solve Jones terms
solve:
  # K -> B -> G on flux calibrator
  - jones: [K, B, G]
    ms: flux_cal.ms
    field: [3C147, 3C147, 3C147]
    ref_ant: 0
    phase_only: [false, false, false]
    freq_interval: [full, 4MHz, full]
    time_interval: [inf, inf, 30s]
    output: flux_cal.h5

  # D (leakage) on polarization calibrator
  - jones: [D]
    ms: flux_cal.ms
    field: [3C286]
    ref_ant: 0
    pre_apply: [K, B, G]
    pre_tables: [flux_cal.h5]
    output: flux_cal.h5

  # G on phase calibrator
  - jones: [G]
    ms: phase_cal.ms
    field: [J1331+305]
    ref_ant: 0
    time_interval: 1min
    pre_apply: [K, B]
    pre_tables: [flux_cal.h5]
    output: phase_cal.h5

# Apply to target
apply:
  - ms: target.ms
    jones: [K, B, G]
    tables: [flux_cal.h5, flux_cal.h5, phase_cal.h5]
    interp_time: [nearest, nearest, linear]
    interp_freq: [nearest, linear, nearest]
    output_col: CORRECTED_DATA
